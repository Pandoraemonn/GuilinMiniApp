// ç¤ºä¾‹æ•°æ®
let users = [
    { id: 1, name: 'User1', icon: 'https://example.com/icon1.png', likes: 0 },
    { id: 2, name: 'User2', icon: 'https://example.com/icon2.png', likes: 0 }
];

// èŽ·å–æŽ’è¡Œæ¦œ
app.get('/rankings', (req, res) => {
    const rankings = users.map(user => ({
        ...user,
        likeButton: ðŸ‘ [${user.likes}]
    }));
    res.json(rankings);
});

// ç‚¹èµžåŠŸèƒ½
app.post('/like/:id', (req, res) => {
    const id = parseInt(req.params.id);
    const user = users.find(u => u.id === id);
    if (user) {
        user.likes += 1;
        res.json({ message: 'Liked!', user });
    } else {
        res.status(404).json({ message: 'User not found' });
    }
});

// Telegram Web App æŽ¥æ”¶æ¶ˆæ¯
bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;
    bot.sendMessage(chatId, 'æ¬¢è¿Žä½¿ç”¨æŽ’è¡Œæ¦œï¼/rank æ¥æŸ¥çœ‹æŽ’è¡Œæ¦œï¼');
});

// æ˜¾ç¤ºæŽ’è¡Œæ¦œ
bot.onText(/\/rank/, async (msg) => {
    const chatId = msg.chat.id;
    let message = 'ðŸ† æŽ’è¡Œæ¦œ:\n';
    for (const user of users) {
        message += ${user.name} - ${user.likes} ðŸ’– \n;
        message += /like_${user.id} æ¥ç»™ä»–ç‚¹èµžï¼\n;
    }
    bot.sendMessage(chatId, message);
});

// ç‚¹èµžå‘½ä»¤
bot.onText(/\/like_(\d+)/, (msg, match) => {
    const userId = parseInt(match[1]);
    const user = users.find(u => u.id === userId);
    if (user) {
        user.likes += 1;
        bot.sendMessage(msg.chat.id, ${user.name} è¢«ç‚¹èµžäº†ï¼çŽ°åœ¨æœ‰ ${user.likes} ä¸ªèµžï¼);
    } else {
        bot.sendMessage(msg.chat.id, 'ç”¨æˆ·ä¸å­˜åœ¨ï¼');
    }
});

// å¯åŠ¨æœåŠ¡å™¨
app.listen(port, () => {
    console.log(Mini App running at http://localhost:${port});
});
